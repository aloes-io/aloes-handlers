"use strict";var mqttPattern=require("mqtt-pattern"),_require=require("../logger"),logger=_require.logger,protocolPatterns=require("../protocol-patterns.json"),clientToAloesLight=function(a,b){// "+prefixedDevEui/+method/+omaObjectId/+sensorId/+omaResourceId",
var c=null,d={prefixedDevEui:"".concat(a.devEui).concat(a.inPrefix),omaObjectId:a.type,sensorId:a.nativeSensorId,omaResourceId:a.resource};return(logger(4,"handlers","clientToAloesLight",d),"POST"===b.method||"PUT"===b.method)?(d.method=1,c=mqttPattern.fill(protocolPatterns.aloesLight.pattern,d),{topic:c,payload:a.value}):"GET"===b.method?(d.method=2,c=mqttPattern.fill(protocolPatterns.aloesLight.pattern,d),{topic:c,payload:a.value}):"Method not supported yet"},clientToMySensors=function(a,b){//  "+prefixedDevEui/+nodeId/+sensorId/+method/+ack/+subType",
var c=null,d={prefixedDevEui:"".concat(a.devEui).concat(a.inPrefix),nodeId:a.nativeNodeId,sensorId:a.nativeSensorId,subType:a.nativeResource};return(logger(4,"handlers","clientToMySensors",d),"POST"===b.method||"PUT"===b.method)?(d.method=2,d.ack=0,c=mqttPattern.fill(protocolPatterns.mySensors.pattern,d),{topic:c,payload:a.value}):"GET"===b.method?(d.method=2,d.ack=0,c=mqttPattern.fill(protocolPatterns.mySensors.pattern,d),{topic:c,payload:a.value}):"Method not supported yet"},aloesClientDecoder=function(a,b){try{logger(4,"handlers","aloesClientDecoder:req",b);var c=JSON.parse(a.payload),d=Object.getOwnPropertyNames(b);if(logger(4,"handlers","aloesClientDecoder:req",d.length),3===d.length||4===d.length){var e;switch(logger(4,"handlers","aloesClientDecoder:req",c),c.protocolName){case"aloesLight":e=clientToAloesLight(c,b);break;case"mySensors":e=clientToMySensors(c,b);break;case"nodeWebcam":// Req
//  await clientToMySensors(app, newPayload);
break;default:e="Protocol not supported yet";}return e}return"topic doesn't match"}catch(a){throw logger(4,"handlers","aloesClientDecoder:err",a),a}};module.exports={clientToAloesLight:clientToAloesLight,clientToMySensors:clientToMySensors,aloesClientDecoder:aloesClientDecoder};
"use strict";function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var mqttPattern=require("mqtt-pattern"),_require=require("../logger"),logger=_require.logger,omaObjects=require("../OMA/oma-objects.json"),omaResources=require("../OMA/oma-resources.json"),omaViews=require("../OMA/oma-views.json"),protocolPatterns=require("../protocol-patterns.json"),aloesLightToOmaObject=function(a){try{logger(4,"handlers","aloesLightToOmaObject:req",a);var d=omaObjects.find(function(b){return b.value===+a.type});if(!d)return"no OMA Object found";var b=omaViews.find(function(b){return b.value===a.type}),c=_objectSpread({},a,{protocolName:"aloesLight",resources:d.resources,name:d.name,icons:b.icons,colors:b.resources,frameCounter:0});return logger(4,"handlers","aloesLightToOmaObject:res",c),c}catch(a){throw logger(2,"handlers","aloesLightToOmaObject:err",a),a}},aloesLightToOmaResources=function(a){try{logger(4,"handlers","aloesLightToOmaResources:req",a);var b=omaObjects.find(function(b){return b.value===+a.type});if(!b)return"no OMA Object found";//  msg.resources[msg.resource.toString()] = msg.value;
var c=_objectSpread({},a);//  sensor.resources = aloesResource.resources;
return logger(4,"handlers","aloesLightToOmaResources:res",c),c}catch(a){throw logger(2,"handlers","aloesLightToOmaResources:err",a),a}},aloesLightDecoder=function(a,b){try{logger(4,"handlers","aloesLightDecoder:req",b);var i=Object.getOwnPropertyNames(b);if(5===i.length){var c,d={};d.devEui=b.devEui;var e=b.prefixedDevEui.split("-"),f="-in",g="-out",h=_objectSpread({},b,{prefixedDevEui:"".concat(e[0]).concat(f)});switch(d.inPrefix=f,d.outPrefix=g,d.devEui=e[0],d.prefix=e[1],d.lastSignal=new Date,+b.method){case 0:d.nativeSensorId=b.sensorId,d.type=+b.omaObjectId,d.nativeType=+b.omaObjectId,d.resource=+b.omaResourceId,d.value=a.payload.toString(),d.inputPath=mqttPattern.fill(protocolPatterns.aloesLight.pattern,h),h.prefixedDevEui="".concat(e[0]).concat(g),d.outputPath=mqttPattern.fill(protocolPatterns.aloesLight.pattern,h),d.method="HEAD",c=aloesLightToOmaObject(d);break;case 1:d.inputPath=mqttPattern.fill(protocolPatterns.aloesLight.pattern,h),h.prefixedDevEui="".concat(e[0]).concat(g),d.outputPath=mqttPattern.fill(protocolPatterns.aloesLight.pattern,h),d.nativeSensorId=b.sensorId,d.type=+b.omaObjectId,d.nativeType=+b.omaObjectId,d.resource=+b.omaResourceId,d.value=a.payload.toString(),d.method="POST",c=aloesLightToOmaResources(d);break;case 2:d.nativeSensorId=b.sensorId,d.type=+b.omaObjectId,d.resource=+b.omaResourceId,d.method="GET",c=d;break;case 3:d.nativeSensorId=b.sensorId,d.value=a.payload.toString();break;case 4:d.nativeSensorId=b.sensorId,d.type=+b.omaObjectId,d.resource=+b.omaResourceId,d.value=a.payload,d.method="STREAM",c=d;break;default:}return c}return"topic doesn't match"}catch(a){throw a}};module.exports={aloesLightToOmaObject:aloesLightToOmaObject,aloesLightToOmaResources:aloesLightToOmaResources,aloesLightDecoder:aloesLightDecoder};
"use strict";function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var mqttPattern=require("mqtt-pattern"),_require=require("../logger"),logger=_require.logger,mySensorsApi=require("./mysensors-api.json"),omaObjects=require("../OMA/oma-objects.json"),omaResources=require("../OMA/oma-resources.json"),omaViews=require("../OMA/oma-views.json"),protocolPatterns=require("../protocol-patterns.json");// device as argument ?
function merge(c,a,b){var d=c.filter(function(c){return!a.find(function(a){return c[b]===a[b]})});return d.concat(a)}var mySensorsToOmaObject=function(a){try{if(logger(2,"handlers","mySensorsToOmaObject:req",a),255===a.sensorId||null===a.type)return null;var d=omaObjects.find(function(b){return b.value===a.type});if(!d)return"no OMA Object found";var b=omaViews.find(function(b){return b.value===a.type}),c=_objectSpread({},a,{protocolName:"mySensors",nativeResources:d.resources,name:d.name,icons:b.icons,colors:b.resources,resources:d.resources,frameCounter:0});return logger(4,"handlers","mySensorsToOmaObject:res",c),c}catch(a){throw logger(2,"handlers","mySensorsToOmaObject:err",a),a}},mySensorsToOmaResources=function(a){try{if(logger(2,"handlers","mySensorsToOmaResources:req",a),255===a.sensorId||!a.resources)return null;var b=Object.getOwnPropertyNames(a.resources);Object.prototype.hasOwnProperty.call(a.resources,b[0])&&(a.resource=b[0]);var c=_objectSpread({},a);return logger(4,"handlers","mySensorsToOmaResources:res",c),c}catch(a){throw logger(2,"handlers","mySensorsToOmaResources:err",a),a}},mySensorsDecoder=function(a,b){var c={};try{logger(4,"handlers","mySensorsDecoder:req",b);var i=Object.getOwnPropertyNames(b);if(6===i.length){var d,e=b.prefixedDevEui.split("-"),f="-in",g="-out",h=_objectSpread({},b,{prefixedDevEui:"".concat(e[0]).concat(f)});switch(c.inPrefix=f,c.outPrefix=g,c.prefix=e[1],c.devEui=e[0],c.lastSignal=new Date,+b.method){case 0:c.nativeNodeId=b.nodeId,c.nativeSensorId=b.sensorId,c.type=mySensorsApi.labelsPresentation[+b.subType].omaObject,c.nativeType=+b.subType,c.value=a.payload.toString(),c.method="HEAD",d=mySensorsToOmaObject(c);break;case 1:c.inputPath=mqttPattern.fill(protocolPatterns.mySensors.pattern,h),h.prefixedDevEui="".concat(e[0]).concat(g),c.outputPath=mqttPattern.fill(protocolPatterns.mySensors.pattern,h),c.nativeNodeId=b.nodeId,c.nativeSensorId=b.sensorId,c.resources=mySensorsApi.labelsSet[+b.subType].omaResources,c.nativeResource=+b.subType,c.value=a.payload.toString(),c.method="POST",d=mySensorsToOmaResources(c);break;case 2:c.nativeNodeId=b.nodeId,c.nativeSensorId=b.sensorId,c.resources=mySensorsApi.labelsSet[+b.subType].omaResources,c.nativeResource=+b.subType,c.method="GET",d=c;break;case 3:c.nativeNodeId=b.nodeId,c.nativeSensorId=b.sensorId,c.type=+b.subType,c.value=a.payload.toString();break;case 4:c.nativeNodeId=b.nodeId,c.nativeSensorId=b.sensorId,c.nativeResource=+b.subType,c.value=a.payload,c.method="STREAM",d=c;break;default:}return d}return"topic doesn't match"}catch(a){throw a}};// sensor as argument ?
module.exports={mySensorsToOmaObject:mySensorsToOmaObject,mySensorsToOmaResources:mySensorsToOmaResources,mySensorsDecoder:mySensorsDecoder};
"use strict";var mqttPattern=require("mqtt-pattern"),_require=require("./logger"),logger=_require.logger,protocolPatterns=require("./protocol-patterns.json"),omaObjects=require("./OMA/oma-objects.json"),omaResources=require("./OMA/oma-resources.json"),omaViews=require("./OMA/oma-views.json"),mySensorsApi=require("./MySensors/mysensors-api.json"),_require2=require("./MySensors"),mySensorsDecoder=_require2.mySensorsDecoder,_require3=require("./Aloes-Light"),aloesLightDecoder=_require3.aloesLightDecoder,_require4=require("./Aloes"),aloesClientDecoder=_require4.aloesClientDecoder,patternDetector=function(a){try{var j={name:"empty",params:null};if(logger(2,"handlers","patternDetector:req",a.topic),"$SYS"===a.topic.split("/")[0])return null;if(mqttPattern.matches(protocolPatterns.aloesClient.collectionPattern,a.topic)){logger(2,"handlers","patternDetector:res","reading AloesClient collection API...");//  const aloesClientProtocol = await extractProtocol(protocolPatterns.aloesClient.collectionPattern, packet.topic);
var k=mqttPattern.exec(protocolPatterns.aloesClient.collectionPattern,a.topic);logger(2,"handlers","patternDetector:res",k);var b=protocolPatterns.aloesClient.validators.collectionName.some(function(a){return a===k.collectionName}),c=protocolPatterns.aloesClient.validators.methods.some(function(a){return a===k.method});// find a signal to check direction ( to app or device ?)
// aloesClientProtocol.target && aloesClientProtocol.target === 'iot'
if(c&&b)return j.name="aloesClient",j.subType="web",j.params=k,j}if(mqttPattern.matches(protocolPatterns.aloesClient.instancePattern,a.topic)){logger(2,"handlers","patternDetector:res","reading AloesClient instance API ...");//  const aloesClientProtocol = await extractProtocol(protocolPatterns.aloesClient.instancePattern, packet.topic);
var l=mqttPattern.exec(protocolPatterns.aloesClient.instancePattern,a.topic);logger(4,"handlers","patternDetector:res",l);//  if (aloesClientProtocol === null) return null;
var d=protocolPatterns.aloesClient.validators.methods.some(function(a){return a===l.method}),e=protocolPatterns.aloesClient.validators.collectionName.some(function(a){return a===l.collectionName});// add amethod  to differentiate subtype
if(d&&e&&"iotagent"===l.collectionName.toLowerCase())return j.name="aloesClient",j.subType="iot",j.params=l,j;if(d&&e)return j.name="aloesClient",j.subType="web",j.params=l,j}if(mqttPattern.matches(protocolPatterns.mySensors.pattern,a.topic)){logger(2,"handlers","patternDetector:res","reading MySensors API ...");//  const mysensorsProtocol = await extractProtocol(protocolPatterns.mySensors.pattern, packet.topic);
var m=mqttPattern.exec(protocolPatterns.mySensors.pattern,a.topic);logger(4,"handlers","patternDetector:res",m);var f=!1,g=protocolPatterns.mySensors.validators.methods.some(function(a){return a===+m.method});if(0===+m.method?f=mySensorsApi.labelsPresentation.some(function(a){return a.value===+m.subType}):0<+m.method&&2>+m.method&&(f=mySensorsApi.labelsSet.some(function(a){return a.value===+m.subType})),logger(4,"handlers","patternDetector:res",{methodExists:g,typeExists:f}),g&&f)return j.name="mySensors",j.params=m,j}if(mqttPattern.matches(protocolPatterns.aloesLight.pattern,a.topic)){logger(2,"handlers","patternDetector:res","reading Aloes Light API ...");//  const aloesProtocol = await extractProtocol(protocolPatterns.aloesLight.pattern, packet.topic);
var n=mqttPattern.exec(protocolPatterns.aloesLight.pattern,a.topic);logger(4,"handlers","patternDetector:res",n);var h=protocolPatterns.aloesLight.validators.methods.some(function(a){return a===+n.method}),i=omaObjects.some(function(a){return a.value===+n.omaObjectId});if(logger(4,"handlers","patternDetector:res",{methodExists:h,omaObjectIdExists:i}),h&&i)return j.name="aloesLight",j.params=n,j}return j.params="topic doesn't match pattern",j}catch(a){return logger(2,"handlers","patternDetector:err",a),a}},isEmpty=function(a){var b=Object.prototype.hasOwnProperty;// null and undefined are "empty"
if(null==a)return!0;if(0<a.length)return!1;if(0===a.length)return!0;for(var c,d=0;d<=a.length;d+=1)if(c=a[d],b.call(a,c))return!1;return!0},publish=function(a){//  logger(4, "pubsub", "publish:req", options);
//  if (options && !isEmpty(options)) {
if(a&&a.data){var b=null,c=a.data;if("mysensors"===a.pattern.toLowerCase()){var d={prefixedDevEui:"".concat(c.devEui).concat(c.inPrefix),nodeId:c.nativeNodeId,sensorId:c.nativeSensorId,subType:c.nativeResource};return(logger(4,"handlers","publish",d),"POST"===a.method)?(d.method=2,d.ack=0,b=mqttPattern.fill(protocolPatterns.mySensors.pattern,d),{topic:b,payload:c.value}):"GET"===a.method?(d.method=2,d.ack=0,b=mqttPattern.fill(protocolPatterns.mySensors.pattern,d),{topic:b,payload:c.value}):"Method not supported yet"}if("aloeslight"===a.pattern.toLowerCase()){var e={prefixedDevEui:"".concat(c.devEui).concat(c.inPrefix),omaObjectId:c.type,sensorId:c.nativeSensorId,omaResourceId:c.resource};return(logger(4,"handlers","publish",e),"POST"===a.method)?(e.method=1,b=mqttPattern.fill(protocolPatterns.aloesLight.pattern,e),{topic:b,payload:c.value}):"GET"===a.method?(e.method=2,b=mqttPattern.fill(protocolPatterns.aloesLight.pattern,e),{topic:b,payload:c.value}):"Method not supported yet"}if("aloesclient"===a.pattern.toLowerCase()){var f={userId:a.userId,collectionName:a.collectionName,modelId:a.modelId,method:a.method};return logger(4,"handlers","publish",f),b="POST"===a.method?mqttPattern.fill(protocolPatterns.aloesClient.collectionPattern,f):"DELETE"===a.method?mqttPattern.fill(protocolPatterns.aloesClient.collectionPattern,f):mqttPattern.fill(protocolPatterns.aloesClient.instancePattern,f),{topic:b,payload:c}}return"Protocol not supported yet"}return new Error("Error: Option must be an object type")},subscribe=function(a,b){if(logger(4,"handlers","subscribe:req",b),b&&!isEmpty(b)){var c=null;if("mysensors"===b.pattern.toLowerCase())c=null;else if("aloesclient"===b.pattern.toLowerCase()){var d={userId:b.userId,collectionName:b.collectionName,modelId:b.modelId,method:b.method};c="POST"===b.method?mqttPattern.fill(protocolPatterns.aloesClient.collectionPattern,d):"DELETE"===b.method?mqttPattern.fill(protocolPatterns.aloesClient.collectionPattern,d):mqttPattern.fill(protocolPatterns.aloesClient.instancePattern,d)}return c}return new Error("Error: Option must be an object type")},publishToNative=function(a){//  logger(4, "pubsub", "publishToNative:req", options);
//  if (options && !isEmpty(options)) {
if(a&&a.data&&a.data.protocolName){var b=null,c=a.data;if("mysensors"===c.protocolName.toLowerCase()){var d={prefixedDevEui:"".concat(c.devEui).concat(c.inPrefix),nodeId:c.nativeNodeId,sensorId:c.nativeSensorId,subType:c.nativeResource};return(logger(4,"handlers","publishToNative",d),"POST"===a.method||"PUT"===a.method)?(d.method=2,d.ack=0,b=mqttPattern.fill(protocolPatterns.mySensors.pattern,d),{topic:b,payload:c.value}):"GET"===a.method?(d.method=2,d.ack=0,b=mqttPattern.fill(protocolPatterns.mySensors.pattern,d),{topic:b,payload:c.value}):"Method not supported yet"}if("aloeslight"===c.protocolName.toLowerCase()){var e={prefixedDevEui:"".concat(c.devEui).concat(c.inPrefix),omaObjectId:c.type,sensorId:c.nativeSensorId,omaResourcesId:c.resource};return(logger(4,"handlers","publishToNative",e),"POST"===a.method||"PUT"===a.method)?(e.method=1,b=mqttPattern.fill(protocolPatterns.aloes.pattern,e),{topic:b,payload:c.value}):"GET"===a.method?(e.method=2,b=mqttPattern.fill(protocolPatterns.aloes.pattern,e),{topic:b,payload:c.value}):"Method not supported yet"}return"Protocol not supported yet"}return new Error("Error: Option must be an object type")},uploadedFiles=[],counter=0;function parseStream(a,b){if(console.log("parseStream.........",a),a.length===b)//console.log(this.counter);
return 1===counter?uploadedFiles=new Blob([a],{type:"image/jpeg"}):uploadedFiles=new Blob([uploadedFiles,a],{type:"image/jpeg"});if(4>=a.length){//console.log("last", this.counter);
new Blob([this.uploadedFiles,a],{type:"image/jpeg"});uploadedFiles=[],counter=0}}var updateAloesSensors=function(a,b,c){switch(logger(4,"handlers","updateAloesSensors",{sensor:a,resource:b,value:c}),+a.type){case 3200:5500===b?(a.resources[b]=!!c,a.value=+a.resources[b],c?++a.resources[5501]:a.resources[5501]=0):5502===b?a.resources[b]=!!c:5503===b?a.resources[b]=+c:5504===b?a.resources[b]=+c:(5750==b||5751==b)&&(a.resources[b]=c);break;case 3201:5550===b?(a.resources[b]=!!c,a.value=+a.resources[b]):5551===b?a.resources[b]=!!c:5750==b&&(a.resources[b]=c);break;case 3202:5600===b?(a.resources[b]=+c,a.value=a.resources[b]):5601===b||5602===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:(5750==b||5751==b)&&(a.resources[b]=c);break;case 3203:5650===b?(a.resources[b]=+c,a.value=a.resources[b]):5603===b||5604===b?a.resources[b]=+c:5750===b&&(a.resources[b]=c);break;case 3300:5700===b?(a.resources[b]=+c,a.value=a.resources[b]):5701===b?a.resources[b]=c:5601===b||5602===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:(5750==b||5751==b)&&(a.resources[b]=c);break;case 3301:5700===b?(a.resources[b]=+c,a.value=a.resources[b]):5701===b?a.resources[b]=c:5601===b||5602===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:(5750==b||5751==b)&&(a.resources[b]=c);break;case 3302:5500===b?(a.resources[b]=+c,a.value=a.resources[b],c?++a.resources[5501]:a.resources[5501]=0):5903===b||5904===b?a.resources[b]=+c:5505===b?a.resources[b]=c:5751==b&&(a.resources[b]=c);break;case 3303:5700===b?(a.resources[b]=+c,a.value=a.resources[b]):5701===b?a.resources[b]=c:5601===b||5602===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:(5750==b||5751==b)&&(a.resources[b]=c);break;case 3304:5700===b?(a.resources[b]=+c,a.value=a.resources[b]):5701===b?a.resources[b]=c:5601===b||5602===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:(5750==b||5751==b)&&(a.resources[b]=c);break;case 3306:5851===b?(a.resources[b]=+c,a.value=a.resources[b],0===a.resources[5851]&&(a.resources[5850]=0)):5850===b?(a.resources[b]=!!c,a.value=+a.resources[b],c?0===a.resources[5852]?a.resources[5852]=new Date:a.resources[5852]-=new Date:a.resources[5852]=0):5853===b?a.resources[b]=c:5750==b&&(a.resources[b]=c);break;case 3308:5900===b?(a.resources[b]=+c,a.value=a.resources[b]):5701===b?a.resources[b]=c:5706===b?a.resources[b]=c:5750==b&&(a.resources[b]=c);break;case 3310:a.resources[5824]=Date(),a.resources[5826]="event";//  sensor.value = sensor.resources["5550"];
break;case 3311:5851===b?(a.resources[b]=+c,a.value=a.resources[b],0===a.resources[5851]&&(a.resources[5850]=0)):5850===b?(a.resources[b]=+c,a.value=a.resources[b],c?0===a.resources[5852]?a.resources[5852]=new Date:a.resources[5852]-=new Date:a.resources[5852]=0):5701===b?a.resources[b]=c:5750==b&&(a.resources[b]=c);break;case 3312:5851===b?(a.resources[b]=+c,0===a.resources[5851]&&(a.resources[5850]=0)):5850===b?(a.resources[b]=+c,c?0===a.resources[5852]?a.resources[5852]=new Date:a.resources[5852]-=new Date:a.resources[5852]=0):5701===b?a.resources[b]=c:5706===b?a.resources[b]=c:5750==b&&(a.resources[b]=c);break;case 3313:5702===b||5703===b||5704===b?(a.resources[b]=+c,a.value=a.resources[b]):5603===b||5604===b?a.resources[b]=+c:5701===b&&(a.resources[b]=c);break;case 3314:5702===b||5703===b||5704===b?(a.resources[b]=+c,a.value=a.resources[b]):5705===b?a.resources[b]=c:5701==b&&(a.resources[b]=c);break;case 3315:5700===b?(a.resources[b]=+c,a.value=a.resources[b]):5701===b?a.resources[b]=c:5601===b||5602===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:(5750==b||5751==b)&&(a.resources[b]=c);break;case 3331:5700===b?(a.resources[b]=c,a.value=a.resources[b]):5822===b?a.resources[b]=c:5701===b?a.resources[b]=c:5750==b&&(a.resources[b]=c);break;case 3332:5601===b||5602===b?a.resources[b]=+c:5705===b?(a.resources[b]=c,a.value=a.resources[b]):5605===b?a.resources[b]=c:5750==b&&(a.resources[b]=c);break;case 3333:5506===b?(c?a.resources[b]=c:!c&&(a.resources[b]=new Date),a.value=a.resources[b]):5507===b?a.resources[b]=+c:5750==b&&(a.resources[b]=c);break;case 3334:5702===b||5703===b||5704===b?(a.resources[b]=+c,a.value=a.resources[b]):5537===b||5538===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:5508===b||5509===b||5510===b||5511===b||5512===b||5512===b?a.resources[b]=+c:5701===b?a.resources[b]=c:5750==b&&(a.resources[b]=c);break;case 3335:5706===b?a.resources[b]=c:5701===b?a.resources[b]=c:5750==b&&(a.resources[b]=c),a.value=a.resources[5706];break;case 3336:5514===b||5515===resources?a.resources[b]=c:5516===b?a.resources[b]=c:5705===b?a.resources[b]=+c:5518===b?a.resources[b]=new Date:5750==b&&(a.resources[b]=c),a.value=[a.resources[5514],a.resources[5515]];break;case 3337:5536===b?(a.resources[b]=+c,a.value=a.resources[b]):5537===b||5538===b?a.resources[b]=+c:5601===b||5602===b?a.resources[b]=+c:5605===b?a.resources[b]=c:5519===b||5520===b?a.resources[b]=+c:5750===b&&(a.resources[b]=c);break;case 3339:5522===b?(a.resources[b]=Buffer.from(c),a.value=a.resources[b]):5523===b?a.resources[b]=c:5548===b?a.resources[b]=+c:5524===b?a.resources[b]=+c:5750==b&&(a.resources[b]=c);break;case 3340:5826===b?a.resources[b]=+c:5521===b||5525===b?a.resources[b]=+c:5523===b?a.resources[b]=c:5534===b?a.resources[b]=+c:5850===b?a.resources[b]=+c:5750==b&&(a.resources[b]=c);// if (sensor.resources["5826"] > 0) {
//   sensor.resources["5521"] = "15"; // delay duration seconds
// } // timer mode
// if (sensor.resources["5826"] > 1) {
//   sensor.resources["5525"] = "15"; //  miniumum offtime seconds
// }
break;case 3341:5527===b?a.resources[b]=c:5528===b?a.resources[b]=+c:5529===b?a.resources[b]=+c:5545===b?a.resources[b]=+c:5546===b?a.resources[b]=+c:5530===b?a.resources[b]=c:5548===b||5531===resources?a.resources[b]=+c:5750===b&&(a.resources[b]=c),a.value=a.resources[b];break;case 3342:5500===b?(c?(++a.resources[5501],0===a.resources[5852]?a.resources[5852]=new Date:a.resources[5852]-=new Date):(a.resources[5501]=0,0===a.resources[5854]?a.resources[5854]=new Date:a.resources[5854]-=new Date),a.resources[5500]=!!c,a.value=+a.resources[5500]):5750==b&&(a.resources[b]=c);break;case 3343:5548===b&&(a.resources[5548]=c,0<a.resources[5548]?0===a.resources[5852]?a.resources[5852]=new Date:a.resources[5852]-=new Date:0===a.resources[5548]&&(0===a.resources[5854]?a.resources[5854]=new Date:a.resources[5854]-=new Date),a.value=a.resources[5548]);break;case 3344:5532===b?(a.resources[5542]=0,++a.resources[5541],a.value=a.resources[5541]):5533===b?(a.resources[5541]=0,++a.resources[5542],a.value=-a.resources[5542]):5750==b&&(a.resources[b]=c);break;case 3345:5702===b||5703===b||5704===b?(a.resources[b]=+c,a.value=a.resources[b]):5500===b?(a.resources[b]=!!c,c?++a.resources[5501]:a.resources[5501]=0):5501===b?a.resources[b]=+c:5750==b&&(a.resources[b]=c);break;case 3347:5500===b?(a.resources[5500]=!!c,c?++a.resources[5501]:a.resources[5501]=0):5750==b&&(a.resources[b]=c);break;case 3349:// bitmap
if(5911===b)a.resources[b]=c;else if(5912===b)a.resources[b]=c;else if(5910===b){if(counter+=1,!c.length)return!1;a.resources[b]=c,a.value=Uint8Array.from(c).buffer,a.buffer=c,console.log("arraytobuffer",Buffer.from(a.value))}else 5750===b&&(a.resources[b]=c);break;case 3350:5544===b?(a.resources[b]=+c,a.value=a.resources[b]):5850===b?(a.resources[b]=!!c,c?++a.resources[5501]:a.resources[5501]=0):5750==b&&(a.resources[b]=c);break;default:5700===b?(a.resources[b]=+c,a.value=a.resources[b]):5701===b?a.resources[b]=c:5601===b||5602===b?a.resources[b]=+c:5603===b||5604===b?a.resources[b]=+c:5605===b?a.resources[b]=c:5821===b?a.resources[b]=+c:5750===b||5751===b?a.resources[b]=c:console.log("READ ONLY");}return a};module.exports={protocolPatterns:protocolPatterns,mySensorsApi:mySensorsApi,omaObjects:omaObjects,omaResources:omaResources,omaViews:omaViews,patternDetector:patternDetector,mySensorsDecoder:mySensorsDecoder,aloesLightDecoder:aloesLightDecoder,aloesClientDecoder:aloesClientDecoder,publish:publish,subscribe:subscribe,publishToNative:publishToNative,updateAloesSensors:updateAloesSensors};
"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}/* eslint-disable no-console */function logger(a,b,c,d){// define priority based on process.env.NODE_ENV
var e,f=+process.env.SERVER_LOGGER_LEVEL||4;if(a<=f)return"object"===_typeof(d)?e="[".concat(b.toUpperCase(),"] ").concat(c," : ").concat(JSON.stringify(d)):"object"!==_typeof(d)&&(e="[".concat(b.toUpperCase(),"] ").concat(c," : ").concat(d)),console.log(e),null;if(a>f)return null;throw new Error("INVALID_LOG","Missing argument in logger")}module.exports={logger:logger};
